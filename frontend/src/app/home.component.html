<!-- Eden Home Component - New UI/UX with Cursor-style Chat -->
<div class="eden-home-container" [ngClass]="{'dark-theme': !isUserSignedIn}" [attr.data-user-signed-in]="isUserSignedIn">
  <!-- Eden Background with Overlay -->
  <div class="eden-background-overlay"></div>
  
  <!-- Global Loading Overlay -->
  <div *ngIf="isGlobalLoading" class="global-loading-overlay">
    <div class="global-loading-card">
      <div class="spinner-border text-primary" role="status" aria-label="Loading"></div>
      <div class="mt-3 fw-semibold">{{ globalLoadingMessage }}</div>
      <div class="small text-muted mt-1">Please wait‚Ä¶</div>
    </div>
  </div>

  <!-- Router Outlet for DEX Garden Wizard -->
  <div style="position: relative; z-index: 10;" *ngIf="isDexWizardRoute">
    <router-outlet></router-outlet>
  </div>

  <!-- Main Content (hidden when on DEX wizard route) -->
  <div *ngIf="!isDexWizardRoute" class="eden-main-content" [attr.data-render-key]="renderKey">
    
    <!-- Header Navigation Bar -->
    <header class="eden-header">
      <div class="eden-header-content">
        <div class="eden-logo">
          <span class="eden-logo-icon">üå≥</span>
          <span class="eden-logo-text">EDEN</span>
        </div>
        <nav class="eden-nav" *ngIf="isUserSignedIn">
          <a href="#" class="eden-nav-link">Docs</a>
          <a href="#" class="eden-nav-link">Gardens</a>
          <a href="#" class="eden-nav-link">Governance</a>
        </nav>
        <div class="eden-header-actions">
          <button class="btn btn-sm eden-theme-toggle" type="button" (click)="toggleTheme()" title="Toggle theme">
            <span *ngIf="theme === 'dark'">üåô</span>
            <span *ngIf="theme === 'light'">‚òÄÔ∏è</span>
          </button>
          <button class="btn eden-signin-btn" [ngClass]="{'btn-primary': isUserSignedIn, 'btn-success': !isUserSignedIn}" (click)="openSignInModal()">
            <span *ngIf="!isUserSignedIn">üîê Sign In</span>
            <span *ngIf="isUserSignedIn">üë§ {{ userEmail }}</span>
          </button>
          <button *ngIf="isUserSignedIn" class="btn btn-sm eden-signout-btn" (click)="signOut()" title="Sign Out">
            Sign Out
          </button>
        </div>
      </div>
    </header>

    <!-- Hero Section (shown when not signed in or as welcome banner) -->
    <section class="eden-hero" *ngIf="!isUserSignedIn">
      <div class="eden-hero-content">
        <h1 class="eden-hero-title">üåø Welcome to Eden</h1>
        <h2 class="eden-hero-subtitle">Garden-First Intelligence Marketplace</h2>
        <p class="eden-hero-tagline">"Conversation as the native interface"</p>
        <div class="eden-hero-actions" *ngIf="!isUserSignedIn">
          <button class="btn btn-lg eden-btn-primary" (click)="openSignInModal()">Start Chatting</button>
          <button class="btn btn-lg eden-btn-secondary">Explore Whitepaper</button>
        </div>
      </div>
    </section>

    <!-- Main Content Area -->
    <div class="eden-content-wrapper">
      
      <!-- Chat History Sidebar (Right Side) -->
      <aside class="eden-chat-history" *ngIf="isUserSignedIn && showSidebar">
        <div class="eden-chat-history-header">
          <h6 class="mb-0">üìú Chat History</h6>
          <button class="btn btn-sm btn-outline-secondary" type="button" (click)="clearChatHistoryPanel()" [disabled]="chatHistoryMessages.length === 0 && !isLoadingChatHistory" title="Clear chat history">
            üóëÔ∏è
          </button>
        </div>
        <div class="eden-chat-history-search">
          <input type="text" class="form-control form-control-sm" placeholder="üîç Search conversations..." />
        </div>
        <div class="eden-chat-history-list">
          <div *ngIf="isLoadingChatHistory" class="text-center py-3">
            <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
          </div>
            <div *ngFor="let msg of chatHistoryMessages; let i = index" class="eden-chat-history-item" [class.active]="msg.id === activeConversationId" (click)="setActiveConversationPublic(msg.id || '')">
            <div class="eden-chat-history-item-header">
              <span class="eden-context-badge badge-system">SYSTEM</span>
              <span class="eden-chat-history-time">{{ msg.timestamp | date:'shortTime' }}</span>
            </div>
            <div class="eden-chat-history-item-content">{{ msg.content | slice:0:50 }}{{ msg.content.length > 50 ? '...' : '' }}</div>
          </div>
          <div *ngIf="!isLoadingChatHistory && chatHistoryMessages.length === 0" class="eden-chat-history-empty">
            <p class="text-muted small">No chat history yet. Start a conversation!</p>
          </div>
        </div>
        <div class="eden-chat-history-filters">
          <button class="btn btn-sm eden-filter-btn active">Active</button>
          <button class="btn btn-sm eden-filter-btn">Forgiven</button>
          <button class="btn btn-sm eden-filter-btn">Redacted</button>
        </div>
      </aside>

      <!-- Main Chat Interface (Cursor-style) -->
      <main class="eden-chat-main" [ngClass]="{'with-sidebar': isUserSignedIn && showSidebar}">
        
        <!-- iGas Display (Top of Chat Area) -->
        <div class="eden-igas-display" *ngIf="isUserSignedIn">
          <app-igas-display 
            [priesthoodStats]="priesthoodStats"
            [walletBalance]="walletBalance"
            [onOpenStripeModal]="openStripePaymentModal.bind(this)">
          </app-igas-display>
        </div>

        <!-- Cursor-Style Chat Window -->
        <div class="eden-chat-window">
          <div class="eden-chat-header">
            <div class="eden-chat-header-left">
              <span class="eden-chat-cert-icon">üîê</span>
              <span class="eden-chat-title">Eden Chat</span>
              <span class="eden-chat-subtitle">‚Ä¢ Certified Session</span>
            </div>
            <div class="eden-chat-header-right">
              <button class="btn btn-sm eden-chat-header-btn" (click)="loadChatHistory()" title="Refresh chat history">
                üîÑ
              </button>
            </div>
          </div>

          <!-- Chat Messages Area -->
          <div class="eden-chat-messages" #chatMessagesContainer>
            <!-- Empty State -->
            <div *ngIf="chatHistoryMessages.length === 0 && !isProcessing" class="eden-chat-empty">
              <div class="eden-chat-empty-icon">üåø</div>
              <h3 class="eden-chat-empty-title">Welcome to Eden Chat</h3>
              <p class="eden-chat-empty-text">Start a conversation by typing a message below. You can ask questions, request services, or start workflows.</p>
            </div>

            <!-- Chat Messages (from chatHistoryMessages or workflow-chat-display) -->
            <div *ngFor="let msg of chatHistoryMessages" class="eden-chat-message" [ngClass]="'eden-chat-message-' + (msg.role || 'system').toLowerCase()">
              <div class="eden-chat-message-content">
                <div class="eden-chat-message-role" *ngIf="msg.role">
                  <span *ngIf="msg.role === 'USER'">You:</span>
                  <span *ngIf="msg.role === 'ASSISTANT'">üåø Eden:</span>
                  <span *ngIf="msg.role === 'SYSTEM'">System:</span>
                </div>
                <div class="eden-chat-message-text" [innerHTML]="msg.content"></div>
                
                <!-- Video Player for Movie Messages -->
                <div *ngIf="msg.videoUrl" class="mt-3" style="display: block !important; visibility: visible !important;">
                  <div class="card" style="display: block !important; visibility: visible !important;">
                    <div class="card-body" style="display: block !important; visibility: visible !important;">
                      <h6 class="card-title" *ngIf="msg.movieTitle">üé¨ {{ msg.movieTitle }}</h6>
                      <video 
                        controls 
                        autoplay
                        class="w-100" 
                        style="max-height: 400px; min-height: 200px; width: 100%; display: block !important; visibility: visible !important; border-radius: 4px; background-color: #000;"
                        [src]="getVideoUrl(msg.videoUrl)"
                        preload="auto">
                        Your browser does not support the video tag.
                      </video>
                      <div class="small text-muted mt-1">
                        Video Source: {{ getVideoUrl(msg.videoUrl) }}
                      </div>
                      <small class="text-muted d-block mt-1">Video URL: {{ msg.videoUrl }}</small>
                    </div>
                  </div>
                </div>
                
                <div class="eden-chat-message-actions">
                  <button class="eden-chat-action-btn" title="Copy message">üìã</button>
                  <button class="eden-chat-action-btn" *ngIf="msg.role === 'USER'" title="Edit message">‚úèÔ∏è</button>
                  <button class="eden-chat-action-btn" *ngIf="msg.role === 'USER'" title="Delete message">üóëÔ∏è</button>
                </div>
              </div>
              <div class="eden-chat-message-timestamp">{{ msg.timestamp | date:'short' }}</div>
            </div>

            <!-- Typing Indicator -->
            <div *ngIf="isProcessing" class="eden-chat-typing">
              <div class="eden-chat-typing-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
              <span class="eden-chat-typing-text">Eden is thinking...</span>
            </div>

            <!-- FlowWise Decision Prompt with Video Player -->
            <div *ngIf="showDecisionPrompt && pendingDecision" class="eden-chat-message eden-chat-message-assistant mb-3">
              <div class="eden-chat-message-content">
                <div class="eden-chat-message-role">
                  <span>üåø Eden:</span>
                </div>
                <div class="alert alert-info mb-0" role="alert">
                  <h5 class="alert-heading">ü§î {{ pendingDecision.prompt }}</h5>
                  <hr>
                  <!-- Debug Info -->
                  <div class="small text-muted mb-2" *ngIf="pendingDecision">
                    üîç DEBUG: videoUrl = "{{ pendingDecision.videoUrl || 'undefined' }}", movieTitle = "{{ pendingDecision.movieTitle || 'undefined' }}"
                    <br>
                    üîç DEBUG: showDecisionPrompt = {{ showDecisionPrompt }}, pendingDecision exists = {{ !!pendingDecision }}
                    <br>
                    üîç DEBUG: videoUrl truthy = {{ !!pendingDecision.videoUrl }}, videoUrl length = {{ pendingDecision.videoUrl?.length || 0 }}
                  </div>
                  <!-- Video Player for Movie Viewing Decision -->
                  <div *ngIf="pendingDecision?.videoUrl" class="mb-3" style="display: block !important; visibility: visible !important; min-height: 250px;">
                    <div class="card" style="display: block !important; visibility: visible !important;">
                      <div class="card-body" style="display: block !important; visibility: visible !important;">
                        <h6 class="card-title" *ngIf="pendingDecision.movieTitle">üé¨ {{ pendingDecision.movieTitle }}</h6>
                        <video 
                          controls 
                          autoplay
                          class="w-100" 
                          style="max-height: 400px; min-height: 200px; width: 100%; display: block !important; visibility: visible !important; border-radius: 4px; background-color: #000;"
                          [src]="getVideoUrl(pendingDecision.videoUrl)"
                          preload="auto">
                          Your browser does not support the video tag.
                        </video>
                        <div class="small text-muted mt-1">
                          Video Source: {{ getVideoUrl(pendingDecision.videoUrl) }}
                        </div>
                        <small class="text-muted d-block mt-1">Video URL: {{ pendingDecision.videoUrl }}</small>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex gap-2 flex-wrap">
                    <button
                      *ngFor="let option of pendingDecision.options"
                      class="btn btn-primary"
                      (click)="submitDecision(option.value)">
                      {{ option.label }}
                    </button>
                  </div>
                  <small class="text-muted mt-2 d-block">
                    This decision will advance the workflow
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Chat Input Area (Cursor-style) -->
          <div class="eden-chat-input-area">
            <div class="eden-chat-input-wrapper">
              <textarea 
                class="eden-chat-input"
                [(ngModel)]="userInput"
                (keydown.enter)="onChatInputEnter($event)"
                (keydown.shift.enter)="true"
                placeholder="üí¨ Type your workflow or question..."
                [disabled]="isProcessing"
                rows="1"
                #chatInput>
              </textarea>
              <button 
                class="btn eden-chat-clear-btn"
                type="button"
                (click)="clearChat()"
                [disabled]="chatHistoryMessages.length === 0 || isProcessing"
                title="Clear chat">
                üóëÔ∏è
              </button>
              <button 
                class="btn eden-chat-send-btn"
                type="button"
                (click)="onEdenChatSubmit()"
                [disabled]="!userInput.trim() || isProcessing"
                title="Send message (Enter)">
                <span *ngIf="!isProcessing">üì§</span>
                <span *ngIf="isProcessing" class="spinner-border spinner-border-sm"></span>
              </button>
            </div>
            <div class="eden-chat-input-hint">
              <small class="text-muted">üí° Ask questions about Eden, request services, or start workflows</small>
            </div>
          </div>
        </div>

        <!-- Garden of Eden Main Street (Service Type Cards) - Below Chat -->
        <div class="eden-main-street" *ngIf="isUserSignedIn && (isLoadingAppleGardens || appleGardens.length > 0 || dexGardens.length > 0)">
          <div class="eden-main-street-header">
            <h5 class="mb-0">üå≥ Garden of Eden Main Street</h5>
            <p class="small mb-3 text-muted">Click a service type - ROOT CA ServiceRegistry will find the best providers</p>
          </div>
          
          <!-- Apple Ecosystem -->
          <div *ngIf="isLoadingAppleGardens || appleGardens.length > 0" class="eden-garden-section">
            <h6 class="mb-2">üçé Apple Ecosystem</h6>
            <div class="row g-2">
              <!-- GOD inbox with Mercy Button (First Element) -->
              <div class="col-6 col-md-4 col-lg-2">
                <div 
                  class="card service-card-compact h-100" 
                  (click)="openPopupChat()" 
                  style="cursor: pointer; border: 2px solid #ffd700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                  <div class="card-body text-center p-2" style="color: white;">
                    <div class="small mb-1">
                      <span class="badge bg-warning text-dark">#0</span>
                    </div>
                    <div class="small fw-bold mb-1" style="font-size: 0.9rem;">
                      ‚ö° GOD inbox with Mercy
                    </div>
                    <div class="small mt-1" style="opacity: 0.9;">
                      <span>üí¨ Direct Access</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-6 col-md-4 col-lg-2" *ngFor="let garden of appleGardens; let idx = index; trackBy: trackByGardenId">
                <div class="card service-card-compact h-100" (click)="selectAppleGarden(garden)" style="cursor: pointer;" [attr.data-garden-id]="garden.id">
                  <div class="card-body text-center p-2" [ngStyle]="getGardenCardStyle(garden.serviceType)">
                    <div class="small mb-1">
                      <span class="badge bg-secondary-subtle text-body-emphasis">#{{ idx + 1 }}</span>
                    </div>
                    <div class="small fw-bold mb-1">{{ garden.name || garden.id }}</div>
                    <div class="small text-muted mt-1">
                      <span *ngIf="garden.serviceType">
                        {{ getServiceTypeIcon(garden.serviceType) }}
                        <span class="ms-1">{{ (garden.serviceType || '').toString().toUpperCase() }}</span>
                      </span>
                    </div>
                    <div class="mt-1">
                      <span class="badge bg-dark-subtle text-body small">
                        Providers: {{ providerCountsByGardenId[garden.id] || 0 }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- DEX Ecosystem -->
          <div *ngIf="dexGardens.length > 0" class="eden-garden-section">
            <h6 class="mb-2">üí∞ DEX Ecosystem</h6>
            <div class="row g-2">
              <div class="col-6 col-md-4 col-lg-2" *ngFor="let garden of dexGardens; let idx = index; trackBy: trackByGardenId">
                <div class="card service-card-compact h-100 dex-service" (click)="selectDexGarden(garden)" style="cursor: pointer;" [attr.data-garden-id]="garden.id">
                  <div class="card-body text-center p-2" [ngStyle]="getGardenCardStyle('dex')">
                    <div class="small mb-1">
                      <span class="badge bg-secondary-subtle text-body-emphasis">#{{ idx + 1 }}</span>
                    </div>
                    <div class="small fw-bold mb-1">{{ garden.name || garden.id }}</div>
                    <div class="small text-muted mt-1">
                      {{ getServiceTypeIcon('dex') }}
                      <span class="ms-1">DEX</span>
                    </div>
                    <div class="mt-1">
                      <span class="badge bg-dark-subtle text-body small">
                        Providers: {{ providerCountsByGardenId[garden.id] || 0 }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tabbed Interface - All Features Migrated -->
        <div class="eden-tabs-container" *ngIf="isUserSignedIn">
          <ul class="nav nav-tabs mb-3">
            <!-- FlowWise Workflows Tab -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'workflow'}" (click)="activeTab = 'workflow'">üîÑ FlowWise Workflows</button>
            </li>
            <!-- FlowWise Workflows Chat Tab -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': $any(activeTab) === 'workflow-chat'}" (click)="setActiveTab('workflow-chat')">üí¨ FlowWise Workflows Chat</button>
            </li>
            <!-- FlowWise Workflow2 (Testbed) Tab -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'workflow2'}" (click)="activeTab = 'workflow2'">üé¨ FlowWise Workflow2 (Testbed)</button>
            </li>
            <!-- Ledger Tab -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'ledger'}" (click)="activeTab = 'ledger'">üìã Ledger - All Eden Bookings</button>
            </li>
            <!-- Ledger Cards Tab (User Mode) -->
            <li class="nav-item" *ngIf="isUserMode">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'ledger-cards'}" (click)="activeTab = 'ledger-cards'">üìã My Bookings (Cards)</button>
            </li>
            <!-- Certificates Tab -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'certificates'}" (click)="activeTab = 'certificates'">üîê Certificates</button>
            </li>
            <!-- Simulator Chat Tab -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'chat'}" (click)="activeTab = 'chat'">üí¨ Simulator Chat</button>
            </li>
            <!-- System Configuration Tab -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'config'}" (click)="activeTab = 'config'">‚öôÔ∏è System Configuration</button>
            </li>
            <!-- LLM Governess Tab -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'governance'}" (click)="activeTab = 'governance'">üúÇ LLM Governess</button>
            </li>
            <!-- System Architecture Tab (visible to all users) -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'architecture'}" (click)="activeTab = 'architecture'">üå≥ System Architecture</button>
            </li>
            <!-- GOD's Inbox Tab -->
            <li class="nav-item">
              <button class="nav-link" [ngClass]="{'active': activeTab === 'god-inbox'}" (click)="activeTab = 'god-inbox'">‚ö° GOD's Inbox</button>
            </li>
          </ul>

          <div class="tab-content">
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'workflow'}">
              <app-workflow-display></app-workflow-display>
            </div>
            <div class="tab-pane fade" [ngClass]="{'show active': $any(activeTab) === 'workflow-chat'}">
              <app-workflow-chat-display></app-workflow-chat-display>
            </div>
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'workflow2'}">
              <app-workflow-display2></app-workflow-display2>
            </div>
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'ledger'}">
              <app-ledger-display></app-ledger-display>
            </div>
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'ledger-cards'}" *ngIf="isUserMode">
              <app-ledger-card-deck></app-ledger-card-deck>
            </div>
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'certificates'}">
              <app-certificate-display></app-certificate-display>
            </div>
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'chat'}">
              <!-- AMC Workflow Active Indicator -->
              <div *ngIf="amcWorkflowActive" class="alert alert-success mb-3">
                <h6>üé¨ AMC Cinema Workflow Active (Atomic Server Execution)</h6>
                <p class="mb-2">Your movie request is being processed through the AMC Cinema workflow.</p>
                <div class="alert alert-info small mb-2">
                  <strong>üîÑ Atomic Execution:</strong> Steps processed entirely on server |
                  <strong>ü§ñ LLM Self-Play:</strong> AI processing automated |
                  <strong>üí∞ Server Autopay:</strong> Payments processed automatically
                  <br><strong>üí¨ Eden Chat:</strong> Use the input field to provide movie preferences.
                </div>
                <div class="progress mb-2">
                  <div class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                       role="progressbar" style="width: 100%">
                    Processing...
                  </div>
                </div>
              </div>

              <!-- FlowWise Decision Prompt -->
              <div *ngIf="showDecisionPrompt && pendingDecision" class="alert alert-info mb-3" role="alert">
                <h5 class="alert-heading">ü§î {{ pendingDecision.prompt }}</h5>
                <hr>
                <!-- Debug Info -->
                <div class="small text-muted mb-2" *ngIf="pendingDecision">
                  üîç DEBUG: videoUrl = "{{ pendingDecision.videoUrl || 'undefined' }}", movieTitle = "{{ pendingDecision.movieTitle || 'undefined' }}"
                  <br>
                  üîç DEBUG: showDecisionPrompt = {{ showDecisionPrompt }}, pendingDecision exists = {{ !!pendingDecision }}
                  <br>
                  üîç DEBUG: videoUrl truthy = {{ !!pendingDecision.videoUrl }}, videoUrl length = {{ pendingDecision.videoUrl?.length || 0 }}
                </div>
                <!-- Video Player for Movie Viewing Decision -->
                <div *ngIf="pendingDecision?.videoUrl" class="mb-3" style="display: block !important; visibility: visible !important; min-height: 250px;">
                  <div class="card" style="display: block !important; visibility: visible !important;">
                    <div class="card-body" style="display: block !important; visibility: visible !important;">
                      <h6 class="card-title" *ngIf="pendingDecision.movieTitle">üé¨ {{ pendingDecision.movieTitle }}</h6>
                      <video 
                        controls 
                        autoplay
                        class="w-100" 
                        style="max-height: 400px; min-height: 200px; width: 100%; display: block !important; visibility: visible !important; border-radius: 4px; background-color: #000;"
                        [src]="getVideoUrl(pendingDecision.videoUrl)"
                        preload="auto">
                        Your browser does not support the video tag.
                      </video>
                      <div class="small text-muted mt-1">
                        Video Source: {{ getVideoUrl(pendingDecision.videoUrl) }}
                      </div>
                      <small class="text-muted d-block mt-1">Video URL: {{ pendingDecision.videoUrl }}</small>
                    </div>
                  </div>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                  <button
                    *ngFor="let option of pendingDecision.options"
                    class="btn btn-primary"
                    (click)="submitDecision(option.value)">
                    {{ option.label }}
                  </button>
                </div>
                <small class="text-muted mt-2 d-block">
                  This decision will advance the AMC workflow
                </small>
              </div>

              <!-- Workflow Messages (when AMC workflow is active) -->
              <div *ngIf="amcWorkflowActive && workflowMessages.length > 0" class="mb-3">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0">üé¨ AMC Workflow Messages</h6>
                  </div>
                  <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                    <div *ngFor="let msg of workflowMessages" class="mb-2">
                      <div [ngClass]="{
                        'text-primary fw-bold': msg.type === 'user_message',
                        'text-success': msg.type === 'llm_response',
                        'text-info': msg.type === 'ledger_entry_added',
                        'text-warning': msg.type === 'cashier_payment_processed',
                        'text-danger': msg.type === 'error'
                      }">
                        <small class="text-muted">[{{ msg.type }}]</small>
                        {{ msg.message }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Stop AMC Workflow Button -->
              <div *ngIf="amcWorkflowActive" class="mb-3 text-center">
                <button
                  type="button"
                  class="btn btn-outline-danger btn-sm"
                  (click)="stopAmcWorkflow()">
                  <i class="fas fa-stop"></i> Stop AMC Workflow
                </button>
              </div>

              <app-chat-box></app-chat-box>
            </div>
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'config'}">
              <app-system-config (gardensRefreshed)="refreshGardens()"></app-system-config>
            </div>
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'governance'}">
              <app-llm-governance *ngIf="activeTab === 'governance'"></app-llm-governance>
            </div>
            <!-- System Architecture Tab (visible to all users) -->
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'architecture'}">
              <div class="p-3">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <div>
                    <h5 class="mb-1">üå≥ System Architecture</h5>
                    <small class="text-muted">Eden Hierarchy</small>
                  </div>
                </div>
                
                <!-- Architecture View Toggle -->
                <div class="mb-3">
                  <div class="btn-group btn-group-sm" role="group">
                    <button 
                      type="button" 
                      class="btn"
                      [ngClass]="{'btn-primary': architectureViewMode === 'tree', 'btn-outline-primary': architectureViewMode !== 'tree'}"
                      (click)="setArchitectureViewMode('tree')"
                      title="Tree View: Hierarchical system architecture">
                      üå≥ Tree View
                    </button>
                    <button 
                      type="button" 
                      class="btn"
                      [ngClass]="{'btn-primary': architectureViewMode === 'table', 'btn-outline-primary': architectureViewMode !== 'table'}"
                      (click)="setArchitectureViewMode('table')"
                      title="Table View: Scalable garden listing">
                      üìä Table View
                    </button>
                  </div>
                </div>
                
                <!-- Table View -->
                <div *ngIf="architectureViewMode === 'table'" class="gardens-table-container">
                  <div class="table-responsive">
                    <table class="table table-sm table-striped table-hover">
                      <thead>
                        <tr>
                          <th>Garden ID</th>
                          <th>Name</th>
                          <th>Service Type</th>
                          <th>Owner Email</th>
                          <th>Type</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngIf="isLoadingArchitectureGardensTable">
                          <td colspan="6" class="text-center py-3">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                          </td>
                        </tr>
                        <tr *ngIf="!isLoadingArchitectureGardensTable && architectureGardensTableData.length === 0">
                          <td colspan="6" class="text-center text-muted py-3">No gardens found</td>
                        </tr>
                        <tr *ngFor="let garden of architectureGardensTableData" [class.table-success]="garden.active" [class.table-secondary]="!garden.active">
                          <td><code>{{ garden.id }}</code></td>
                          <td><strong>{{ garden.name }}</strong></td>
                          <td>
                            <span class="badge" [ngClass]="getServiceTypeBadgeClass(garden.serviceType)">
                              <span class="me-1">{{ getServiceTypeIcon(garden.serviceType) }}</span>
                              {{ garden.serviceType }}
                            </span>
                          </td>
                          <td><small>{{ garden.ownerEmail }}</small></td>
                          <td>
                            <span class="badge" 
                                  [ngClass]="{
                                    'bg-info': garden.type === 'root',
                                    'bg-primary': garden.type === 'token',
                                    'bg-secondary': garden.type === 'regular' || !garden.type
                                  }">
                              {{ garden.type || 'regular' }}
                            </span>
                          </td>
                          <td>
                            <span class="badge" [ngClass]="{'bg-success': garden.active, 'bg-secondary': !garden.active}">
                              {{ garden.active ? 'Active' : 'Inactive' }}
                            </span>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                
                <!-- Tree View -->
                <div *ngIf="architectureViewMode === 'tree'" class="architecture-tree-container">
                  <!-- ROOT CA at the top -->
                  <div *ngFor="let group of architectureGroups" class="component-group">
                    <ng-container *ngIf="group.category === 'root'">
                      <div 
                        class="group-header d-flex justify-content-between align-items-center cursor-pointer"
                        [class.bg-light]="group.expanded"
                        (click)="toggleArchitectureGroup(group)"
                        [attr.data-category]="group.category">
                        <div class="d-flex align-items-center">
                          <span class="group-icon">{{ group.icon }}</span>
                          <span class="group-name" [ngClass]="getArchitectureCategoryColor(group.category)">{{ group.name }}</span>
                          <span class="badge bg-secondary badge-xs">{{ group.components.length }}</span>
                        </div>
                        <span class="toggle-icon">{{ group.expanded ? '‚ñº' : '‚ñ∂' }}</span>
                      </div>
                      
                      <div *ngIf="group.expanded" class="group-components">
                        <!-- Service Registry sub-group (only for ROOT CA) -->
                        <div *ngIf="group.category === 'root' && getArchitectureRootCAServiceRegistry().length > 0" class="sub-group">
                          <div class="sub-group-label">Service Registry</div>
                          <div 
                            *ngFor="let component of getArchitectureRootCAServiceRegistry()" 
                            class="component-item border-start border-2"
                            [ngClass]="getArchitectureStatusClass(component.status)"
                            [class.border-success]="component.status === 'success'"
                            [class.border-danger]="component.status === 'error'"
                            [class.border-warning]="component.status === 'active'"
                            [class.border-secondary]="component.status === 'idle'">
                            <div class="d-flex justify-content-between align-items-center">
                              <div class="d-flex align-items-center">
                                <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                <span class="component-name">{{ component.name }}</span>
                              </div>
                              <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                            </div>
                          </div>
                        </div>
                        
                        <!-- Other ROOT CA components (non-ServiceRegistry) -->
                        <ng-container *ngIf="group.category === 'root'">
                          <ng-container *ngFor="let component of group.components">
                            <div 
                              *ngIf="component.category !== 'service-registry'"
                              class="component-item border-start border-2"
                              [ngClass]="getArchitectureStatusClass(component.status)"
                              [class.border-success]="component.status === 'success'"
                              [class.border-danger]="component.status === 'error'"
                              [class.border-warning]="component.status === 'active'"
                              [class.border-secondary]="component.status === 'idle'">
                              <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                  <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                  <span class="component-name">{{ component.name }}</span>
                                </div>
                                <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                              </div>
                            </div>
                          </ng-container>
                          <!-- ROOT CA LLM Service (GOD-controlled data access) -->
                          <div 
                            *ngIf="architectureComponents.get('root-ca-llm-getdata')"
                            class="component-item border-start border-2 border-warning"
                            [ngClass]="getArchitectureStatusClass(architectureComponents.get('root-ca-llm-getdata')?.status || 'idle')"
                            [class.border-success]="architectureComponents.get('root-ca-llm-getdata')?.status === 'success'"
                            [class.border-danger]="architectureComponents.get('root-ca-llm-getdata')?.status === 'error'"
                            [class.border-warning]="architectureComponents.get('root-ca-llm-getdata')?.status === 'active'"
                            [class.border-secondary]="architectureComponents.get('root-ca-llm-getdata')?.status === 'idle'">
                            <div class="d-flex justify-content-between align-items-center">
                              <div class="d-flex align-items-center">
                                <span class="status-icon">{{ getArchitectureStatusIcon(architectureComponents.get('root-ca-llm-getdata')?.status || 'idle') }}</span>
                                <span class="component-name">üëë {{ architectureComponents.get('root-ca-llm-getdata')?.name }}</span>
                              </div>
                              <span class="badge bg-warning badge-xs">{{ architectureComponents.get('root-ca-llm-getdata')?.count || 0 }}</span>
                            </div>
                          </div>
                        </ng-container>
                      </div>
                    </ng-container>
                  </div>
                  
                  <!-- Garden Tabs -->
                  <div *ngIf="getFilteredArchitectureGardens().length > 0" class="garden-tabs-container">
                    <div class="garden-tabs">
                      <button 
                        *ngFor="let garden of getFilteredArchitectureGardens()" 
                        class="garden-tab"
                        [class.active]="selectedArchitectureGardenTab === garden.id"
                        [class.token-garden]="garden.type === 'token'"
                        [class.root-garden]="garden.type === 'root'"
                        type="button"
                        (click)="selectArchitectureGardenTab(garden.id)">
                        <span class="tab-icon">
                          {{ getArchitectureGardenIcon(garden) }}
                        </span>
                        <span class="tab-label">{{ garden.name }}</span>
                      </button>
                    </div>
                  </div>
                  
                  <!-- Architecture Tree -->
                  <div class="architecture-tree">
                    <div *ngFor="let group of architectureGroups" class="component-group">
                      <ng-container *ngIf="group.category !== 'root'">
                        <div 
                          class="group-header d-flex justify-content-between align-items-center cursor-pointer"
                          [class.bg-light]="group.expanded"
                          (click)="toggleArchitectureGroup(group)"
                          [attr.data-category]="group.category">
                          <div class="d-flex align-items-center">
                            <span class="group-icon">{{ group.icon }}</span>
                            <span class="group-name" [ngClass]="getArchitectureCategoryColor(group.category)">{{ group.name }}</span>
                            <span class="badge bg-secondary badge-xs">{{ group.components.length }}</span>
                          </div>
                          <span class="toggle-icon">{{ group.expanded ? '‚ñº' : '‚ñ∂' }}</span>
                        </div>
                        
                        <div *ngIf="group.expanded" class="group-components">
                          <!-- Nested structure for Gardens: Show components for selected garden tab -->
                          <ng-container *ngIf="group.category === 'indexer'">
                            <!-- Selected Garden Node -->
                            <div *ngIf="selectedArchitectureGardenTab" class="garden-node">
                              <div class="garden-header">
                                <span class="garden-icon">
                                  {{ getArchitectureSelectedGardenIcon() }}
                                </span>
                                <span class="garden-name">{{ getArchitectureSelectedGardenName() }}</span>
                                <span class="badge bg-success badge-xs">{{ getArchitectureSelectedGardenNodeCount() }}</span>
                              </div>
                              
                              <div class="garden-components">
                                <!-- Holy Ghost (ROOT CA Garden) shows Infrastructure Services -->
                                <ng-container *ngIf="selectedArchitectureGardenTab === 'HG'">
                                  <!-- Infrastructure Services -->
                                  <div *ngIf="getArchitectureSelectedGardenInfrastructureServices().length > 0" class="sub-group">
                                    <div class="sub-group-label">Infrastructure Services</div>
                                    <div 
                                      *ngFor="let component of getArchitectureSelectedGardenInfrastructureServices()" 
                                      class="component-item border-start border-2"
                                      [ngClass]="getArchitectureStatusClass(component.status)"
                                      [class.border-success]="component.status === 'success'"
                                      [class.border-danger]="component.status === 'error'"
                                      [class.border-warning]="component.status === 'active'"
                                      [class.border-secondary]="component.status === 'idle'">
                                      <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                          <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                          <span class="component-name">{{ component.name }}</span>
                                        </div>
                                        <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                                      </div>
                                    </div>
                                  </div>
                                </ng-container>
                                
                                <!-- Regular/Token Gardens show Infrastructure Services and Service Providers -->
                                <ng-container *ngIf="selectedArchitectureGardenTab !== 'HG'">
                                  <!-- Infrastructure Services -->
                                  <div *ngIf="getArchitectureSelectedGardenInfrastructureServices().length > 0" class="sub-group">
                                    <div class="sub-group-label">Infrastructure Services</div>
                                    <div 
                                      *ngFor="let component of getArchitectureSelectedGardenInfrastructureServices()" 
                                      class="component-item border-start border-2"
                                      [ngClass]="getArchitectureStatusClass(component.status)"
                                      [class.border-success]="component.status === 'success'"
                                      [class.border-danger]="component.status === 'error'"
                                      [class.border-warning]="component.status === 'active'"
                                      [class.border-secondary]="component.status === 'idle'">
                                      <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                          <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                          <span class="component-name">{{ component.name }}</span>
                                        </div>
                                        <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                                      </div>
                                    </div>
                                  </div>
                                  <!-- Service Providers -->
                                  <div *ngIf="getArchitectureSelectedGardenRegularServiceProviders().length > 0" class="sub-group">
                                    <div class="sub-group-label">Service Providers</div>
                                    <div 
                                      *ngFor="let component of getArchitectureSelectedGardenRegularServiceProviders()" 
                                      class="component-item border-start border-2"
                                      [ngClass]="getArchitectureStatusClass(component.status)"
                                      [class.border-success]="component.status === 'success'"
                                      [class.border-danger]="component.status === 'error'"
                                      [class.border-warning]="component.status === 'active'"
                                      [class.border-secondary]="component.status === 'idle'">
                                      <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                          <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                          <span class="component-name">{{ component.name }}</span>
                                        </div>
                                        <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                                      </div>
                                    </div>
                                  </div>
                                </ng-container>
                                
                                <!-- LLM (shown for all gardens) -->
                                <div *ngIf="getArchitectureSelectedGardenLLM().length > 0" class="sub-group">
                                  <div class="sub-group-label">LLM Intelligence</div>
                                  <div 
                                    *ngFor="let component of getArchitectureSelectedGardenLLM()" 
                                    class="component-item border-start border-2"
                                    [ngClass]="getArchitectureStatusClass(component.status)"
                                    [class.border-success]="component.status === 'success'"
                                    [class.border-danger]="component.status === 'error'"
                                    [class.border-warning]="component.status === 'active'"
                                    [class.border-secondary]="component.status === 'idle'">
                                    <div class="d-flex justify-content-between align-items-center">
                                      <div class="d-flex align-items-center">
                                        <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                        <span class="component-name">{{ component.name }}</span>
                                      </div>
                                      <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                                    </div>
                                  </div>
                                </div>
                                
                                <!-- EdenCore -->
                                <div *ngIf="getArchitectureSelectedGardenEdenCore().length > 0" class="sub-group">
                                  <div class="sub-group-label">EdenCore</div>
                                  <div 
                                    *ngFor="let component of getArchitectureSelectedGardenEdenCore()" 
                                    class="component-item border-start border-2"
                                    [ngClass]="getArchitectureStatusClass(component.status)"
                                    [class.border-success]="component.status === 'success'"
                                    [class.border-danger]="component.status === 'error'"
                                    [class.border-warning]="component.status === 'active'"
                                    [class.border-secondary]="component.status === 'idle'">
                                    <div class="d-flex justify-content-between align-items-center">
                                      <div class="d-flex align-items-center">
                                        <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                        <span class="component-name">{{ component.name }}</span>
                                      </div>
                                      <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                                    </div>
                                  </div>
                                </div>
                                
                                <!-- Users -->
                                <div *ngIf="getArchitectureSelectedGardenUsers().length > 0" class="sub-group">
                                  <div class="sub-group-label">Users</div>
                                  <div 
                                    *ngFor="let component of getArchitectureSelectedGardenUsers()" 
                                    class="component-item border-start border-2"
                                    [ngClass]="getArchitectureStatusClass(component.status)"
                                    [class.border-success]="component.status === 'success'"
                                    [class.border-danger]="component.status === 'error'"
                                    [class.border-warning]="component.status === 'active'"
                                    [class.border-secondary]="component.status === 'idle'">
                                    <div class="d-flex justify-content-between align-items-center">
                                      <div class="d-flex align-items-center">
                                        <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                        <span class="component-name">{{ component.name }}</span>
                                      </div>
                                      <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            
                            <!-- Replication Bus (shared infrastructure) -->
                            <div *ngIf="getArchitectureReplicationBus().length > 0" class="sub-group">
                              <div class="sub-group-label">Replication Bus</div>
                              <div 
                                *ngFor="let component of getArchitectureReplicationBus()" 
                                class="component-item border-start border-2"
                                [ngClass]="getArchitectureStatusClass(component.status)"
                                [class.border-success]="component.status === 'success'"
                                [class.border-danger]="component.status === 'error'"
                                [class.border-warning]="component.status === 'active'"
                                [class.border-secondary]="component.status === 'idle'">
                                <div class="d-flex justify-content-between align-items-center">
                                  <div class="d-flex align-items-center">
                                    <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                    <span class="component-name">{{ component.name }}</span>
                                  </div>
                                  <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                                </div>
                              </div>
                            </div>
                          </ng-container>
                          
                          <!-- Regular flat list for non-Garden groups (Infrastructure, etc.) -->
                          <ng-container *ngIf="group.category !== 'indexer'">
                            <div 
                              *ngFor="let component of group.components" 
                              class="component-item border-start border-2"
                              [ngClass]="getArchitectureStatusClass(component.status)"
                              [class.border-success]="component.status === 'success'"
                              [class.border-danger]="component.status === 'error'"
                              [class.border-warning]="component.status === 'active'"
                              [class.border-secondary]="component.status === 'idle'">
                              <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                  <span class="status-icon">{{ getArchitectureStatusIcon(component.status) }}</span>
                                  <span class="component-name">{{ component.name }}</span>
                                </div>
                                <span class="badge bg-secondary badge-xs">{{ component.count }}</span>
                              </div>
                            </div>
                          </ng-container>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                  
                  <div *ngIf="architectureGroups.length === 0" class="empty-state">
                    <small class="text-muted">Waiting for events...</small>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" [ngClass]="{'show active': activeTab === 'god-inbox'}">
              <app-god-inbox *ngIf="activeTab === 'god-inbox'"></app-god-inbox>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Status Bar (Fixed Bottom) -->
    <footer class="eden-status-bar">
      <div class="eden-status-content">
        <div class="eden-status-left">
          <span class="eden-status-indicator" [ngClass]="{'connected': true, 'disconnected': false}">‚óè</span>
          <span class="eden-status-text">Connected to Garden Network</span>
          <span class="eden-status-separator">‚Ä¢</span>
          <span class="eden-status-indicator active">‚óè</span>
          <span class="eden-status-text">Certified Identity: Active</span>
          <span class="eden-status-separator">‚Ä¢</span>
          <span class="eden-status-text">iGas: {{ walletBalance.toFixed(1) }}</span>
        </div>
        <div class="eden-status-right">
          <span class="eden-status-text">Version: Eden v1.28</span>
          <span class="eden-status-separator">‚Ä¢</span>
          <span class="eden-status-text">Last Sync: Just now</span>
        </div>
      </div>
    </footer>
  </div>

  <!-- Include all modals from original app component -->
  <!-- Sign In Modal -->
  <div class="modal fade" id="signInModal" tabindex="-1" [class.show]="showSignInModal" [style.display]="showSignInModal ? 'block' : 'none'">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <span *ngIf="!isGoogleSignedIn">üë§ Guest</span>
            <span *ngIf="isGoogleSignedIn">üë§ Account Settings</span>
          </h5>
          <button type="button" class="btn-close" (click)="closeSignInModal()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Mode Selection and Login Form (same as app.component.html) -->
          <div *ngIf="!isGoogleSignedIn">
            <div *ngIf="showModeSelection && !showLoginForm" class="mb-4">
              <div class="text-center mb-4">
                <h5 class="mb-2">üå≥ Welcome to Eden Simulator</h5>
                <p class="text-muted mb-3">Please select your view mode before signing in</p>
              </div>
              <div class="row g-3">
                <div class="col-12">
                  <button type="button" class="btn w-100 text-start p-3" [ngClass]="{'btn-primary': selectedMode === 'god', 'btn-outline-primary': selectedMode !== 'god'}" (click)="selectedMode = 'god'; proceedToLogin()">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <div>
                        <strong class="fs-5">‚õ™ GOD Mode</strong>
                        <span class="badge bg-warning text-dark ms-2">Admin Only</span>
                      </div>
                      <span *ngIf="selectedMode === 'god'" class="badge bg-light text-dark">Selected</span>
                    </div>
                    <small class="d-block text-muted">Shows ROOT CA and all infrastructure. Full system access for administrators.</small>
                  </button>
                </div>
                <div class="col-12">
                  <button type="button" class="btn w-100 text-start p-3" [ngClass]="{'btn-success': selectedMode === 'priest', 'btn-outline-success': selectedMode !== 'priest'}" (click)="selectedMode = 'priest'; proceedToLogin()">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <div>
                        <strong class="fs-5">üõê Priest Mode</strong>
                        <span class="badge bg-warning text-dark ms-2">Admin Only</span>
                      </div>
                      <span *ngIf="selectedMode === 'priest'" class="badge bg-light text-dark">Selected</span>
                    </div>
                    <small class="d-block text-muted">Hides system architecture sidebar (like User mode). For administrators who want a cleaner view without infrastructure details.</small>
                  </button>
                </div>
                <div class="col-12">
                  <button type="button" class="btn w-100 text-start p-3" [ngClass]="{'btn-secondary': selectedMode === 'user', 'btn-outline-secondary': selectedMode !== 'user'}" (click)="selectedMode = 'user'; proceedToLogin()">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <div>
                        <strong class="fs-5">üë§ USER Mode</strong>
                        <span class="badge bg-info text-white ms-2">Standard</span>
                      </div>
                      <span *ngIf="selectedMode === 'user'" class="badge bg-light text-dark">Selected</span>
                    </div>
                    <small class="d-block text-muted">Standard user view with no sidebar. Filtered views showing only your bookings and services.</small>
                  </button>
                </div>
              </div>
            </div>
            <div *ngIf="showLoginForm || isGoogleSignedIn">
              <form (ngSubmit)="signInWithEmail()" class="mb-4">
                <div class="mb-3">
                  <label for="email" class="form-label">Email Address</label>
                  <input type="email" class="form-control form-control-lg" id="email" [(ngModel)]="signInEmail" name="email" placeholder="Enter your email" required>
                </div>
                <div class="mb-3">
                  <label for="password" class="form-label">Password</label>
                  <input type="password" class="form-control form-control-lg" id="password" [(ngModel)]="signInPassword" name="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-lg w-100 mb-3" [disabled]="isSigningIn">
                  <span *ngIf="!isSigningIn">Sign In</span>
                  <span *ngIf="isSigningIn">
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                    Signing In...
                  </span>
                </button>
              </form>
              <div class="text-center mb-3">
                <span class="text-muted">OR</span>
              </div>
              <div class="text-center">
                <p class="mb-3">Sign in with your Google account</p>
                <div id="google-signin-button-modal" style="min-width: 200px; min-height: 40px; margin: 0 auto;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeSignInModal()">Close</button>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="showSignInModal" class="modal-backdrop fade show" (click)="closeSignInModal()"></div>

  <!-- Include other modals (Stripe Payment, Garden Shutdown, etc.) from app.component.html -->
  <!-- For brevity, these are referenced but should be copied from app.component.html -->
  
  <!-- Popup Chat Component -->
  <app-popup-chat *ngIf="showPopupChat" [userEmail]="userEmail" (close)="closePopupChat()"></app-popup-chat>
</div>
