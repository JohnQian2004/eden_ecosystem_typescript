<div class="container-fluid p-3" [class.has-video-player]="showVideoPlayer && selectedVideoForPlayer">
  <!-- Video Details Modal -->
  <div class="modal fade" id="videoDetailsModal" tabindex="-1" style="z-index: 100000;">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <app-video-details *ngIf="selectedVideo" [video]="selectedVideo" (close)="closeDetailsModal()"></app-video-details>
      </div>
    </div>
  </div>

  <!-- Fullscreen Video Player Overlay -->
  <div class="video-player-overlay" [class.show]="showVideoPlayer && selectedVideoForPlayer" (click)="closeVideoPlayer()">
    <div class="video-player-container" (click)="$event.stopPropagation()" *ngIf="selectedVideoForPlayer">
      <div class="video-player-header">
        <div class="video-player-title">
          <i class="bi bi-play-circle-fill me-2"></i>
          {{ selectedVideoForPlayer.filename || 'Video Player' }}
        </div>
        <div class="d-flex gap-2">
          <button type="button" class="btn btn-sm btn-outline-light" (click)="toggleDetailsInPlayer(); $event.stopPropagation()" [class.active]="showDetailsInPlayer" title="Toggle Details">
            <i class="bi" [class.bi-info-circle]="!showDetailsInPlayer" [class.bi-x-circle]="showDetailsInPlayer" me-2></i>
            {{ showDetailsInPlayer ? 'Hide Details' : 'View Details' }}
          </button>
          <button type="button" class="btn btn-sm btn-outline-light" (click)="closeVideoPlayer()" aria-label="Close" title="Close (Esc)">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
      </div>
      <div class="video-player-body" [class.with-details]="showDetailsInPlayer">
        <div class="video-section" *ngIf="!showDetailsInPlayer">
          <video
            #videoPlayerElement
            class="w-100"
            [src]="getVideoPlayerUrl(selectedVideoForPlayer)"
            controls
            playsinline
            autoplay
          >
            Your browser does not support the video tag.
          </video>
        </div>
        <div class="details-section" *ngIf="showDetailsInPlayer">
          <app-video-details [video]="selectedVideoForPlayer" [hideVideoPlayer]="true" (close)="toggleDetailsInPlayer()"></app-video-details>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-0">ðŸŽ¬ Video Library</h1>
      <small class="text-muted">
        <i class="bi bi-collection me-1"></i>
        {{ (filteredVideos.length > 0 ? filteredVideos.length : videos.length) }} video{{ (filteredVideos.length > 0 ? filteredVideos.length : videos.length) !== 1 ? 's' : '' }} 
        <span class="ms-2">
          <i class="bi bi-hdd me-1"></i>
          Total Size: {{ librarySizeFormatted }}
        </span>
      </small>
    </div>
    <div class="d-flex gap-2">
      <button
        class="btn btn-success"
        (click)="analyzeAllVideos()"
        title="Analyze all unanalyzed videos"
      >
        <i class="bi bi-search me-2"></i>
        Analyze All
      </button>
      <button
        class="btn btn-outline-primary"
        (click)="syncVideos()"
        [disabled]="syncing"
        title="Sync videos from data/videos directory"
      >
        <i class="bi bi-arrow-clockwise" [class.spin]="syncing"></i>
        {{ syncing ? 'Syncing...' : 'Sync Videos' }}
      </button>
      <app-video-upload (uploaded)="onVideoUploaded()"></app-video-upload>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          [(ngModel)]="searchQuery"
          (keyup.enter)="onSearch()"
          placeholder="Search by filename, tags..."
        />
        <button class="btn btn-outline-secondary" type="button" (click)="onSearch()">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </div>
    <div class="col-md-2">
      <select
        class="form-select"
        [(ngModel)]="selectedFilters.shot_type"
        (change)="onFilterChange()"
      >
        <option value="">All Shot Types</option>
        <option value="close-up">Close-up</option>
        <option value="medium">Medium</option>
        <option value="wide">Wide</option>
        <option value="extreme-wide">Extreme Wide</option>
      </select>
    </div>
    <div class="col-md-2">
      <select
        class="form-select"
        [(ngModel)]="selectedFilters.scene_type"
        (change)="onFilterChange()"
      >
        <option value="">All Scene Types</option>
        <option value="indoor">Indoor</option>
        <option value="outdoor">Outdoor</option>
        <option value="nature">Nature</option>
        <option value="urban">Urban</option>
      </select>
    </div>
  </div>

  <!-- Content Tags Filter (Multi-select badges) -->
  <div class="mb-3" *ngIf="allContentTags.length > 0">
    <label class="form-label small text-muted mb-2 d-block">
      <i class="bi bi-tags me-1"></i>Content Tags (click to filter):
    </label>
    <div class="content-tags-filter">
      <span
        *ngFor="let tag of allContentTags"
        class="badge content-tag-badge me-2 mb-2"
        [class.bg-primary]="isContentTagSelected(tag)"
        [class.bg-secondary]="!isContentTagSelected(tag)"
        [class.selected]="isContentTagSelected(tag)"
        (click)="toggleContentTag(tag)"
        style="cursor: pointer;"
      >
        {{ tag }}
        <i *ngIf="isContentTagSelected(tag)" class="bi bi-check-circle ms-1"></i>
      </span>
      <button
        *ngIf="selectedFilters.content_tags && selectedFilters.content_tags.length > 0"
        class="btn btn-sm btn-outline-secondary ms-2 mb-2"
        (click)="selectedFilters.content_tags = []; applyContentTagFilter(); calculateLibrarySize();"
        title="Clear all content tag filters"
      >
        <i class="bi bi-x-circle me-1"></i>Clear
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading videos...</p>
  </div>

  <div *ngIf="!loading && videos.length === 0" class="text-center py-5">
    <i class="bi bi-collection-play" style="font-size: 64px; color: #ccc;"></i>
    <h2 class="mt-3 text-muted">No videos found</h2>
    <p class="text-muted">Upload your first video to get started!</p>
  </div>
  <div *ngIf="!loading && videos.length > 0 && filteredVideos.length === 0 && selectedFilters.content_tags && selectedFilters.content_tags.length > 0" class="text-center py-5">
    <i class="bi bi-funnel" style="font-size: 64px; color: #ccc;"></i>
    <h2 class="mt-3 text-muted">No videos match the selected content tag</h2>
    <p class="text-muted">Try selecting a different content tag filter.</p>
  </div>

  <div *ngIf="!loading && (filteredVideos.length > 0 || videos.length > 0)" class="row g-1 overflow-x-hidden">
    <div class="col-auto" *ngFor="let video of (filteredVideos.length > 0 ? filteredVideos : videos)" style="width: 80px; max-width: 80px;">
      <app-video-card
        [video]="video"
        (deleted)="onVideoDeleted()"
        (details)="openDetailsModal($event)"
        (playVideo)="onPlayVideo($event)"
      ></app-video-card>
    </div>
  </div>
</div>

