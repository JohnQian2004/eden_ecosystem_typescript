{
  "version": 3,
  "sources": ["../../scripts/generate-pki-certs.ts"],
  "sourcesContent": ["#!/usr/bin/env ts-node\r\n\r\n/**\r\n * PKI Certificate Generation Script\r\n * Generates CA, server, and client certificates for HTTPS/WSS\r\n */\r\n\r\nimport * as crypto from \"crypto\";\r\nimport * as fs from \"fs\";\r\nimport * as path from \"path\";\r\n\r\nconst CERT_DIR = path.join(__dirname, \"..\", \"certs\");\r\nconst CA_KEY_PATH = path.join(CERT_DIR, \"ca-key.pem\");\r\nconst CA_CERT_PATH = path.join(CERT_DIR, \"ca-cert.pem\");\r\nconst SERVER_KEY_PATH = path.join(CERT_DIR, \"server-key.pem\");\r\nconst SERVER_CERT_PATH = path.join(CERT_DIR, \"server-cert.pem\");\r\nconst CLIENT_KEY_PATH = path.join(CERT_DIR, \"client-key.pem\");\r\nconst CLIENT_CERT_PATH = path.join(CERT_DIR, \"client-cert.pem\");\r\n\r\n// Ensure certs directory exists\r\nif (!fs.existsSync(CERT_DIR)) {\r\n  fs.mkdirSync(CERT_DIR, { recursive: true });\r\n  console.log(`\u2705 Created certs directory: ${CERT_DIR}`);\r\n}\r\n\r\n/**\r\n * Generate a self-signed certificate\r\n */\r\nfunction generateCertificate(\r\n  commonName: string,\r\n  subjectAltNames: string[] = [],\r\n  issuerKey?: crypto.KeyObject,\r\n  issuerCert?: crypto.X509Certificate,\r\n  isCA: boolean = false\r\n): { key: crypto.KeyObject; cert: Buffer } {\r\n  // Generate key pair\r\n  const { privateKey, publicKey } = crypto.generateKeyPairSync(\"rsa\", {\r\n    modulusLength: 2048,\r\n    publicKeyEncoding: {\r\n      type: \"spki\",\r\n      format: \"pem\",\r\n    },\r\n    privateKeyEncoding: {\r\n      type: \"pkcs8\",\r\n      format: \"pem\",\r\n    },\r\n  });\r\n\r\n  const keyObject = crypto.createPrivateKey(privateKey);\r\n\r\n  // Certificate options\r\n  const certOptions: any = {\r\n    subject: {\r\n      CN: commonName,\r\n      O: \"Eden Ecosystem\",\r\n      OU: \"PKI\",\r\n      C: \"US\",\r\n    },\r\n    issuer: issuerCert\r\n      ? issuerCert.subject\r\n      : {\r\n          CN: commonName,\r\n          O: \"Eden Ecosystem\",\r\n          OU: \"PKI\",\r\n          C: \"US\",\r\n        },\r\n    notBefore: new Date(),\r\n    notAfter: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n    serialNumber: crypto.randomBytes(8).toString(\"hex\"),\r\n    keyUsage: isCA\r\n      ? [\"keyCertSign\", \"cRLSign\"]\r\n      : [\"digitalSignature\", \"keyEncipherment\"],\r\n    extKeyUsage: isCA ? [] : [\"serverAuth\", \"clientAuth\"],\r\n  };\r\n\r\n  if (subjectAltNames.length > 0) {\r\n    certOptions.subjectAltName = subjectAltNames.map((name) => {\r\n      if (name.startsWith(\"IP:\")) {\r\n        return `IP:${name.substring(3)}`;\r\n      } else if (name.includes(\":\")) {\r\n        return `IP:${name}`;\r\n      } else {\r\n        return `DNS:${name}`;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Create certificate\r\n  const cert = new crypto.X509Certificate(\r\n    crypto.x509Certificate({\r\n      ...certOptions,\r\n      publicKey: publicKey,\r\n      signingKey: issuerKey || keyObject,\r\n    })\r\n  );\r\n\r\n  return {\r\n    key: keyObject,\r\n    cert: Buffer.from(cert.toString(\"pem\")),\r\n  };\r\n}\r\n\r\n/**\r\n * Generate CA certificate\r\n */\r\nfunction generateCA(): { key: crypto.KeyObject; cert: Buffer } {\r\n  console.log(\"\uD83D\uDD10 Generating CA certificate...\");\r\n  const { key, cert } = generateCertificate(\"Eden Root CA\", [], undefined, undefined, true);\r\n\r\n  // Save CA key and cert\r\n  fs.writeFileSync(CA_KEY_PATH, crypto.createPrivateKey(key.export({ format: \"pem\", type: \"pkcs8\" })).export({ format: \"pem\", type: \"pkcs8\" }));\r\n  fs.writeFileSync(CA_CERT_PATH, cert);\r\n\r\n  console.log(`\u2705 CA certificate generated:`);\r\n  console.log(`   Key: ${CA_KEY_PATH}`);\r\n  console.log(`   Cert: ${CA_CERT_PATH}`);\r\n\r\n  return { key, cert };\r\n}\r\n\r\n/**\r\n * Generate server certificate\r\n */\r\nfunction generateServerCert(caKey: crypto.KeyObject, caCert: Buffer): { key: crypto.KeyObject; cert: Buffer } {\r\n  console.log(\"\uD83D\uDD10 Generating server certificate...\");\r\n  \r\n  const caCertObj = new crypto.X509Certificate(caCert);\r\n  const subjectAltNames = [\r\n    \"localhost\",\r\n    \"127.0.0.1\",\r\n    \"::1\",\r\n    \"IP:127.0.0.1\",\r\n    \"IP:::1\",\r\n  ];\r\n\r\n  const { key, cert } = generateCertificate(\r\n    \"Eden Server\",\r\n    subjectAltNames,\r\n    caKey,\r\n    caCertObj,\r\n    false\r\n  );\r\n\r\n  // Save server key and cert\r\n  fs.writeFileSync(SERVER_KEY_PATH, crypto.createPrivateKey(key.export({ format: \"pem\", type: \"pkcs8\" })).export({ format: \"pem\", type: \"pkcs8\" }));\r\n  fs.writeFileSync(SERVER_CERT_PATH, cert);\r\n\r\n  console.log(`\u2705 Server certificate generated:`);\r\n  console.log(`   Key: ${SERVER_KEY_PATH}`);\r\n  console.log(`   Cert: ${SERVER_CERT_PATH}`);\r\n\r\n  return { key, cert };\r\n}\r\n\r\n/**\r\n * Generate client certificate\r\n */\r\nfunction generateClientCert(caKey: crypto.KeyObject, caCert: Buffer): { key: crypto.KeyObject; cert: Buffer } {\r\n  console.log(\"\uD83D\uDD10 Generating client certificate...\");\r\n  \r\n  const caCertObj = new crypto.X509Certificate(caCert);\r\n\r\n  const { key, cert } = generateCertificate(\r\n    \"Eden Client\",\r\n    [],\r\n    caKey,\r\n    caCertObj,\r\n    false\r\n  );\r\n\r\n  // Save client key and cert\r\n  fs.writeFileSync(CLIENT_KEY_PATH, crypto.createPrivateKey(key.export({ format: \"pem\", type: \"pkcs8\" })).export({ format: \"pem\", type: \"pkcs8\" }));\r\n  fs.writeFileSync(CLIENT_CERT_PATH, cert);\r\n\r\n  console.log(`\u2705 Client certificate generated:`);\r\n  console.log(`   Key: ${CLIENT_KEY_PATH}`);\r\n  console.log(`   Cert: ${CLIENT_CERT_PATH}`);\r\n\r\n  return { key, cert };\r\n}\r\n\r\n// Main execution\r\nconsole.log(\"\uD83D\uDD10 ========================================\");\r\nconsole.log(\"\uD83D\uDD10 Eden PKI Certificate Generation\");\r\nconsole.log(\"\uD83D\uDD10 ========================================\\n\");\r\n\r\ntry {\r\n  // Generate CA\r\n  const { key: caKey, cert: caCert } = generateCA();\r\n\r\n  // Generate server cert signed by CA\r\n  generateServerCert(caKey, caCert);\r\n\r\n  // Generate client cert signed by CA\r\n  generateClientCert(caKey, caCert);\r\n\r\n  console.log(\"\\n\u2705 ========================================\");\r\n  console.log(\"\u2705 All certificates generated successfully!\");\r\n  console.log(\"\u2705 ========================================\");\r\n  console.log(\"\\n\uD83D\uDCDD Next steps:\");\r\n  console.log(\"   1. Import ca-cert.pem into your browser/OS trust store\");\r\n  console.log(\"   2. Start server with --enable-https true\");\r\n  console.log(\"   3. Access Angular via https://localhost:3000\");\r\n} catch (error: any) {\r\n  console.error(\"\u274C Error generating certificates:\", error.message);\r\n  console.error(error.stack);\r\n  process.exit(1);\r\n}\r\n\r\n"],
  "mappings": "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",
  "names": []
}
