{
  "version": 3,
  "sources": ["../../src/priesthoodCertification.ts"],
  "sourcesContent": ["/**\r\n * PriestHood Certification Service\r\n * Manages the lifecycle of PRIEST user certifications\r\n */\r\n\r\nimport * as fs from 'fs';\r\nimport * as path from 'path';\r\nimport * as crypto from 'crypto';\r\nimport { ROOT_CA } from './state';\r\nimport { CERTIFICATE_REGISTRY, REVOCATION_REGISTRY } from './state';\r\nimport type { EdenCertificate } from './types';\r\n\r\nexport type PriesthoodStatus = 'pending' | 'approved' | 'rejected' | 'revoked' | 'suspended';\r\n\r\n// Fee constants - Low entry fee model\r\nexport const APPLICATION_FEE = 1; // JSC - one-time, non-refundable (Covenant Token / Witness Apple)\r\nexport const MEMBERSHIP_FEE = 0; // JSC - FREE (membership is free, authority is trust-based and rate-limited)\r\nexport const MEMBERSHIP_PERIOD_MS = 30 * 24 * 60 * 60 * 1000; // 30 days in milliseconds (for tracking, but no payment required)\r\n\r\n// Rate limiting constants (non-monetary friction)\r\nexport const PRIEST_RATE_LIMITS = {\r\n  maxActionsPerDay: 20,\r\n  maxBlessingsPerHour: 3,\r\n  maxDisputesHandled: 5,\r\n  maxGardensCreated: 10 // Per month\r\n};\r\n\r\n// Trust/Reputation system (for future scaling of authority)\r\nexport interface PriestTrustScore {\r\n  email: string;\r\n  score: number; // 0-100\r\n  timeServed: number; // Days since certification\r\n  positiveOutcomes: number;\r\n  auditsPassed: number;\r\n  complaints: number;\r\n  reversals: number;\r\n  lastUpdated: number;\r\n}\r\n\r\nexport interface PriesthoodCertification {\r\n  email: string;\r\n  status: PriesthoodStatus;\r\n  appliedAt: number;\r\n  approvedAt?: number;\r\n  approvedBy?: string; // GOD user email\r\n  rejectedAt?: number;\r\n  rejectedBy?: string;\r\n  revokedAt?: number;\r\n  revokedBy?: string;\r\n  reason?: string;\r\n  certificate?: EdenCertificate;\r\n  metadata?: Record<string, any>;\r\n  // Billing fields (low entry fee model)\r\n  applicationFeePaid?: boolean;\r\n  applicationFeeTxId?: string;\r\n  // Membership is now FREE - these fields track activity/trust instead\r\n  membershipActiveUntil?: number; // Timestamp when membership period ends (for tracking, not payment)\r\n  lastActivityDate?: number; // Last date of priest activity\r\n  activityCount?: number; // Actions performed in current period\r\n  trustScore?: number; // 0-100, based on time served, outcomes, audits\r\n  // Rate limiting tracking\r\n  dailyActionCount?: number; // Actions today\r\n  lastActionReset?: number; // Timestamp when daily count was reset\r\n  suspendedForNonPayment?: boolean; // Legacy field (now used for inactivity/abuse)\r\n}\r\n\r\nconst CERTIFICATIONS_FILE = path.join(__dirname, '..', 'eden-priest-certifications.json');\r\nconst CERTIFICATIONS: Map<string, PriesthoodCertification> = new Map();\r\n\r\n/**\r\n * Initialize the PriestHood Certification Service\r\n */\r\nexport function initializePriesthoodCertification(): void {\r\n  console.log('\uD83D\uDCDC [PriestHood Certification] Initializing service...');\r\n  \r\n  // Load existing certifications from persistence\r\n  if (fs.existsSync(CERTIFICATIONS_FILE)) {\r\n    try {\r\n      const data = JSON.parse(fs.readFileSync(CERTIFICATIONS_FILE, 'utf-8'));\r\n      if (data.certifications && Array.isArray(data.certifications)) {\r\n        for (const cert of data.certifications) {\r\n          CERTIFICATIONS.set(cert.email.toLowerCase(), cert);\r\n        }\r\n        console.log(`   \u2705 Loaded ${CERTIFICATIONS.size} priesthood certification(s) from persistence`);\r\n      }\r\n    } catch (err: any) {\r\n      console.error(`   \u274C Failed to load certifications: ${err.message}`);\r\n    }\r\n  } else {\r\n    console.log(`   \u2139\uFE0F  No existing certifications file found, starting fresh`);\r\n  }\r\n}\r\n\r\n/**\r\n * Save certifications to persistence file\r\n */\r\nfunction saveCertifications(): void {\r\n  try {\r\n    const certifications = Array.from(CERTIFICATIONS.values());\r\n    const data = {\r\n      certifications,\r\n      lastSaved: new Date().toISOString()\r\n    };\r\n    fs.writeFileSync(CERTIFICATIONS_FILE, JSON.stringify(data, null, 2), 'utf-8');\r\n    console.log(`\uD83D\uDCBE [PriestHood Certification] Saved ${certifications.length} certification(s) to persistence`);\r\n  } catch (err: any) {\r\n    console.error(`\u274C [PriestHood Certification] Failed to save certifications: ${err.message}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Apply for priesthood certification\r\n */\r\nexport function applyForPriesthood(email: string, reason?: string): PriesthoodCertification {\r\n  const emailLower = email.toLowerCase();\r\n  \r\n  // Check if user already has a certification\r\n  const existing = CERTIFICATIONS.get(emailLower);\r\n  if (existing && (existing.status === 'approved' || existing.status === 'pending')) {\r\n    throw new Error(`User ${email} already has a ${existing.status} priesthood certification`);\r\n  }\r\n  \r\n  // Create new application\r\n  const certification: PriesthoodCertification = {\r\n    email: emailLower,\r\n    status: 'pending',\r\n    appliedAt: Date.now(),\r\n    reason: reason || 'User application for priesthood certification',\r\n    metadata: {},\r\n    applicationFeePaid: false,\r\n    activityCount: 0,\r\n    trustScore: 0,\r\n    dailyActionCount: 0\r\n  };\r\n  \r\n  CERTIFICATIONS.set(emailLower, certification);\r\n  saveCertifications();\r\n  \r\n  console.log(`\uD83D\uDCDC [PriestHood Certification] New application from ${email}`);\r\n  \r\n  return certification;\r\n}\r\n\r\n/**\r\n * Update certification billing information\r\n */\r\nexport function updateCertificationBilling(\r\n  email: string, \r\n  updates: Partial<Pick<PriesthoodCertification, 'applicationFeePaid' | 'applicationFeeTxId' | 'membershipActiveUntil' | 'lastActivityDate' | 'activityCount' | 'trustScore' | 'dailyActionCount' | 'lastActionReset' | 'suspendedForNonPayment'>>\r\n): PriesthoodCertification {\r\n  const emailLower = email.toLowerCase();\r\n  const certification = CERTIFICATIONS.get(emailLower);\r\n  \r\n  if (!certification) {\r\n    throw new Error(`No priesthood certification found for ${email}`);\r\n  }\r\n  \r\n  // Update billing fields\r\n  if (updates.applicationFeePaid !== undefined) {\r\n    certification.applicationFeePaid = updates.applicationFeePaid;\r\n  }\r\n  if (updates.applicationFeeTxId !== undefined) {\r\n    certification.applicationFeeTxId = updates.applicationFeeTxId;\r\n  }\r\n  if (updates.membershipActiveUntil !== undefined) {\r\n    certification.membershipActiveUntil = updates.membershipActiveUntil;\r\n  }\r\n  if (updates.lastActivityDate !== undefined) {\r\n    certification.lastActivityDate = updates.lastActivityDate;\r\n  }\r\n  if (updates.activityCount !== undefined) {\r\n    certification.activityCount = updates.activityCount;\r\n  }\r\n  if (updates.trustScore !== undefined) {\r\n    certification.trustScore = updates.trustScore;\r\n  }\r\n  if (updates.dailyActionCount !== undefined) {\r\n    certification.dailyActionCount = updates.dailyActionCount;\r\n  }\r\n  if (updates.lastActionReset !== undefined) {\r\n    certification.lastActionReset = updates.lastActionReset;\r\n  }\r\n  if (updates.suspendedForNonPayment !== undefined) {\r\n    certification.suspendedForNonPayment = updates.suspendedForNonPayment;\r\n    // Auto-suspend if non-payment\r\n    if (updates.suspendedForNonPayment && certification.status === 'approved') {\r\n      certification.status = 'suspended';\r\n      console.log(`\uD83D\uDCDC [PriestHood Certification] Auto-suspended ${email} for non-payment`);\r\n    }\r\n  }\r\n  \r\n  CERTIFICATIONS.set(emailLower, certification);\r\n  saveCertifications();\r\n  \r\n  return certification;\r\n}\r\n\r\n/**\r\n * Approve a priesthood application\r\n */\r\nexport function approvePriesthood(email: string, approvedBy: string, reason?: string): PriesthoodCertification {\r\n  const emailLower = email.toLowerCase();\r\n  const certification = CERTIFICATIONS.get(emailLower);\r\n  \r\n  if (!certification) {\r\n    throw new Error(`No priesthood application found for ${email}`);\r\n  }\r\n  \r\n  if (certification.status !== 'pending') {\r\n    throw new Error(`Cannot approve certification with status: ${certification.status}`);\r\n  }\r\n  \r\n  // Issue certificate using ROOT_CA\r\n  const priestUuid = `priest:${emailLower}:${Date.now()}`;\r\n  const certificate = ROOT_CA.issueCertificate({\r\n    subject: priestUuid,\r\n    capabilities: ['PRIEST_MODE', 'CREATE_GARDEN', 'MANAGE_GARDENS'],\r\n    constraints: {\r\n      email: emailLower,\r\n      grantedBy: approvedBy,\r\n      grantedAt: Date.now(),\r\n      priesthoodLevel: 'certified'\r\n    },\r\n    ttlSeconds: 365 * 24 * 60 * 60 // 1 year\r\n  });\r\n  \r\n  // Store certificate in registry\r\n  CERTIFICATE_REGISTRY.set(priestUuid, certificate);\r\n  \r\n  // Update certification\r\n  certification.status = 'approved';\r\n  certification.approvedAt = Date.now();\r\n  certification.approvedBy = approvedBy;\r\n  certification.certificate = certificate;\r\n  if (reason) {\r\n    certification.reason = reason;\r\n  }\r\n  \r\n  CERTIFICATIONS.set(emailLower, certification);\r\n  saveCertifications();\r\n  \r\n  console.log(`\uD83D\uDCDC [PriestHood Certification] Approved priesthood for ${email} by ${approvedBy}`);\r\n  \r\n  return certification;\r\n}\r\n\r\n/**\r\n * Reject a priesthood application\r\n */\r\nexport function rejectPriesthood(email: string, rejectedBy: string, reason?: string): PriesthoodCertification {\r\n  const emailLower = email.toLowerCase();\r\n  const certification = CERTIFICATIONS.get(emailLower);\r\n  \r\n  if (!certification) {\r\n    throw new Error(`No priesthood application found for ${email}`);\r\n  }\r\n  \r\n  if (certification.status !== 'pending') {\r\n    throw new Error(`Cannot reject certification with status: ${certification.status}`);\r\n  }\r\n  \r\n  // Update certification\r\n  certification.status = 'rejected';\r\n  certification.rejectedAt = Date.now();\r\n  certification.rejectedBy = rejectedBy;\r\n  if (reason) {\r\n    certification.reason = reason;\r\n  }\r\n  \r\n  CERTIFICATIONS.set(emailLower, certification);\r\n  saveCertifications();\r\n  \r\n  console.log(`\uD83D\uDCDC [PriestHood Certification] Rejected priesthood application for ${email} by ${rejectedBy}`);\r\n  \r\n  return certification;\r\n}\r\n\r\n/**\r\n * Revoke an existing priesthood certification\r\n */\r\nexport function revokePriesthood(email: string, revokedBy: string, reason?: string): PriesthoodCertification {\r\n  const emailLower = email.toLowerCase();\r\n  const certification = CERTIFICATIONS.get(emailLower);\r\n  \r\n  if (!certification) {\r\n    throw new Error(`No priesthood certification found for ${email}`);\r\n  }\r\n  \r\n  if (certification.status !== 'approved') {\r\n    throw new Error(`Cannot revoke certification with status: ${certification.status}`);\r\n  }\r\n  \r\n  // Revoke certificate if it exists\r\n  if (certification.certificate) {\r\n    // Remove from certificate registry\r\n    CERTIFICATE_REGISTRY.delete(certification.certificate.subject);\r\n    \r\n    // Store certificate hash for revocation record\r\n    const certHash = `sha256:${crypto.createHash('sha256').update(JSON.stringify(certification.certificate)).digest('hex')}`;\r\n    \r\n    // Create revocation record\r\n    const revocation = {\r\n      revoked_uuid: certification.certificate.subject,\r\n      revoked_type: 'priest',\r\n      reason: reason || 'Priesthood certification revoked',\r\n      effective_at: Date.now(),\r\n      cert_hash: certHash,\r\n      severity: 'hard',\r\n      metadata: { revokedBy, email: emailLower }\r\n    };\r\n    \r\n    REVOCATION_REGISTRY.set(certification.certificate.subject, revocation);\r\n    console.log(`\uD83D\uDCDC [PriestHood Certification] Revoked certificate for ${emailLower}`);\r\n  }\r\n  \r\n  // Update certification\r\n  certification.status = 'revoked';\r\n  certification.revokedAt = Date.now();\r\n  certification.revokedBy = revokedBy;\r\n  if (reason) {\r\n    certification.reason = reason;\r\n  }\r\n  certification.certificate = undefined;\r\n  \r\n  CERTIFICATIONS.set(emailLower, certification);\r\n  saveCertifications();\r\n  \r\n  console.log(`\uD83D\uDCDC [PriestHood Certification] Revoked priesthood for ${email} by ${revokedBy}`);\r\n  \r\n  return certification;\r\n}\r\n\r\n/**\r\n * Get certification status for a user\r\n */\r\nexport function getCertificationStatus(email: string): PriesthoodCertification | null {\r\n  const emailLower = email.toLowerCase();\r\n  return CERTIFICATIONS.get(emailLower) || null;\r\n}\r\n\r\n/**\r\n * Check if user has approved priesthood certification\r\n */\r\nexport function hasPriesthoodCertification(email: string): boolean {\r\n  const certification = getCertificationStatus(email);\r\n  return certification?.status === 'approved' && !!certification.certificate;\r\n}\r\n\r\n/**\r\n * Get all certifications (for GOD mode management)\r\n */\r\nexport function getAllCertifications(): PriesthoodCertification[] {\r\n  return Array.from(CERTIFICATIONS.values());\r\n}\r\n\r\n/**\r\n * Get certifications by status\r\n */\r\nexport function getCertificationsByStatus(status: PriesthoodStatus): PriesthoodCertification[] {\r\n  return Array.from(CERTIFICATIONS.values()).filter(cert => cert.status === status);\r\n}\r\n\r\n/**\r\n * Check and auto-suspend priests for inactivity or abuse\r\n * Since membership is now FREE, we check for inactivity instead of payment\r\n * This should be called periodically (e.g., daily cron job)\r\n */\r\nexport function checkAndSuspendInactivePriests(): void {\r\n  const now = Date.now();\r\n  const INACTIVITY_THRESHOLD_MS = 90 * 24 * 60 * 60 * 1000; // 90 days of inactivity\r\n  const all = getAllCertifications();\r\n  let suspendedCount = 0;\r\n  \r\n  for (const cert of all) {\r\n    if (cert.status === 'approved') {\r\n      const lastActivity = cert.lastActivityDate || cert.approvedAt || 0;\r\n      const daysSinceActivity = (now - lastActivity) / (24 * 60 * 60 * 1000);\r\n      \r\n      if (daysSinceActivity > 90) {\r\n        // Inactive for 90+ days - suspend\r\n        updateCertificationBilling(cert.email, {\r\n          suspendedForNonPayment: true // Reusing field for inactivity\r\n        });\r\n        suspendedCount++;\r\n        console.log(`\uD83D\uDCDC [PriestHood Certification] Auto-suspended ${cert.email} - inactive for ${Math.floor(daysSinceActivity)} days`);\r\n      }\r\n    }\r\n  }\r\n  \r\n  if (suspendedCount > 0) {\r\n    console.log(`\uD83D\uDCDC [PriestHood Certification] Auto-suspended ${suspendedCount} priest(s) for inactivity`);\r\n  }\r\n}\r\n\r\n/**\r\n * Check rate limits for a priest action\r\n * Returns true if action is allowed, false if rate limited\r\n */\r\nexport function checkPriestRateLimit(email: string, actionType: 'action' | 'blessing' | 'dispute' | 'garden'): boolean {\r\n  const certification = getCertificationStatus(email);\r\n  if (!certification || certification.status !== 'approved') {\r\n    return false;\r\n  }\r\n  \r\n  const now = Date.now();\r\n  const oneDayAgo = now - (24 * 60 * 60 * 1000);\r\n  \r\n  // Reset daily count if needed\r\n  if (!certification.lastActionReset || certification.lastActionReset < oneDayAgo) {\r\n    certification.dailyActionCount = 0;\r\n    certification.lastActionReset = now;\r\n  }\r\n  \r\n  // Check rate limits based on action type\r\n  switch (actionType) {\r\n    case 'action':\r\n      if ((certification.dailyActionCount || 0) >= PRIEST_RATE_LIMITS.maxActionsPerDay) {\r\n        console.log(`\u26A0\uFE0F  [PriestHood] Rate limit: ${email} exceeded daily action limit (${PRIEST_RATE_LIMITS.maxActionsPerDay})`);\r\n        return false;\r\n      }\r\n      certification.dailyActionCount = (certification.dailyActionCount || 0) + 1;\r\n      break;\r\n    case 'garden':\r\n      // Check monthly garden creation limit\r\n      const monthlyGardenCount = certification.activityCount || 0;\r\n      if (monthlyGardenCount >= PRIEST_RATE_LIMITS.maxGardensCreated) {\r\n        console.log(`\u26A0\uFE0F  [PriestHood] Rate limit: ${email} exceeded monthly garden creation limit (${PRIEST_RATE_LIMITS.maxGardensCreated})`);\r\n        return false;\r\n      }\r\n      break;\r\n    // Add other action types as needed\r\n  }\r\n  \r\n  // Update last activity\r\n  certification.lastActivityDate = now;\r\n  saveCertifications();\r\n  \r\n  return true;\r\n}\r\n\r\n/**\r\n * Get statistics for dashboard\r\n */\r\nexport function getCertificationStats(): {\r\n  total: number;\r\n  pending: number;\r\n  approved: number;\r\n  rejected: number;\r\n  revoked: number;\r\n  suspended: number;\r\n  revenue?: {\r\n    applicationFees: number;\r\n    membershipFees: number;\r\n    total: number;\r\n  };\r\n} {\r\n  const all = getAllCertifications();\r\n  const stats = {\r\n    total: all.length,\r\n    pending: all.filter(c => c.status === 'pending').length,\r\n    // \"Certified Priests\" must come from PriestHoodService truth:\r\n    // approved + certificate present (legacy rows may be \"approved\" but missing cert)\r\n    approved: all.filter(c => c.status === 'approved' && !!c.certificate).length,\r\n    rejected: all.filter(c => c.status === 'rejected').length,\r\n    revoked: all.filter(c => c.status === 'revoked').length,\r\n    suspended: all.filter(c => c.status === 'suspended').length,\r\n    revenue: {\r\n      applicationFees: all.filter(c => c.applicationFeePaid).length * APPLICATION_FEE,\r\n      membershipFees: 0, // Membership is now FREE\r\n      total: 0\r\n    }\r\n  };\r\n  stats.revenue.total = stats.revenue.applicationFees + stats.revenue.membershipFees;\r\n  return stats;\r\n}\r\n\r\n"],
  "mappings": "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",
  "names": ["import_state"]
}
